(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"2hq7":function(e,t,n){"use strict";n.r(t);var a=n("hTPA"),r=n("Xp2Q");function o(e,t,n,a,r,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(a,r)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function c(e){o(i,a,r,c,u,"next",e)}function u(e){o(i,a,r,c,u,"throw",e)}c(void 0)})}}var c={components:{DefaultScreen:function(){return Promise.all([n.e(0),n.e(2),n.e(3)]).then(n.bind(null,"gzPp"))}},props:{database:{type:String,default:"vuejx_cfg"},collection:{type:String,default:""},site:{type:String,default:"guest"},id:{type:String,default:"NULL"}},setup:function(e,t){var n=Object(r.a)(e,t),o=n.valid,c=n.postData,u=n.toURL,l=n.pullDetail,s=n.metadataConfig,_=n.render,p=n.addData,d=n.editData,v=n.pullConfig,f=n.removeData,g=n.loading,m=(n.clean,n.refresh),b=n.mergeOAI;Object(a.onMounted)(i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:_.value=!0;case 3:case"end":return e.stop()}},e)})));var D=function(){var t=i(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("NULL"!==e.id){t.next=5;break}return t.next=3,v();case 3:t.next=7;break;case 5:return t.next=7,l();case 7:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();return{valid:o,postData:c,metadataConfig:s,render:_,addData:p,editData:d,toURL:u,pullConfig:v,removeData:f,loading:g,refresh:m,mergeOAI:b}}},u=n("KHd+"),l=Object(u.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-banner",{staticClass:"px-0",attrs:{"single-line":"",sticky:!0},scopedSlots:e._u([{key:"actions",fn:function(){return["NULL"!==e.id&&"oai_pmh_config"===e.collection?n("v-btn",{attrs:{icon:"",loading:e.loading,disabled:e.loading},on:{click:e.mergeOAI}},[n("v-icon",{attrs:{color:"primary"}},[e._v("mdi-source-merge")])],1):e._e(),e._v(" "),"NULL"===e.id?n("v-btn",{attrs:{icon:"",loading:e.loading,disabled:e.loading},on:{click:e.addData}},[n("v-icon",{attrs:{color:"primary"}},[e._v("mdi-database-plus")])],1):e._e(),e._v(" "),"NULL"!==e.id?n("v-btn",{attrs:{icon:"",loading:e.loading,disabled:e.loading},on:{click:e.removeData}},[n("v-icon",{attrs:{color:"error"}},[e._v("mdi-database-remove")])],1):e._e(),e._v(" "),"NULL"!==e.id?n("v-btn",{attrs:{icon:"",loading:e.loading,disabled:e.loading},on:{click:function(t){return e.editData(0)}}},[n("v-icon",{attrs:{color:"primary"}},[e._v("mdi-database-check")])],1):e._e(),e._v(" "),"NULL"!==e.id?n("v-btn",{attrs:{icon:"",loading:e.loading,disabled:e.loading},on:{click:function(t){return e.editData(1)}}},[n("v-icon",[e._v("mdi-database-edit")])],1):e._e(),e._v(" "),n("v-btn",{attrs:{icon:""},on:{click:e.refresh}},[n("v-icon",[e._v("mdi-database-refresh")])],1),e._v(" "),n("v-btn",{staticStyle:{"margin-left":"0",width:"16px"},attrs:{icon:""}},[n("v-icon",[e._v("mdi-dots-vertical")])],1)]},proxy:!0}])},[n("v-btn",{staticStyle:{float:"left"},attrs:{text:"",icon:""},on:{click:function(t){return e.$router.go(-1)}}},[n("v-icon",[e._v("mdi-backburger")])],1),e._v(" "),"NULL"===e.id?n("v-toolbar-title",{staticStyle:{"max-width":"800px",float:"left"}},[e._v("Thêm mới")]):n("v-toolbar-title",{staticStyle:{"max-width":"800px",float:"left"}},[e._v(e._s(e.postData.title))])],1),e._v(" "),n("v-sheet",{staticClass:"mx-auto"},[e.render?n("default-screen",{attrs:{config:e.metadataConfig,data:e.postData,id:e.id}}):e._e()],1)],1)},[],!1,null,null,null);t.default=l.exports},Xp2Q:function(module,__webpack_exports__,__webpack_require__){"use strict";var vue_function_api__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("hTPA"),_config__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("8SHQ");function asyncGeneratorStep(e,t,n,a,r,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(a,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function i(e){asyncGeneratorStep(o,a,r,i,c,"next",e)}function c(e){asyncGeneratorStep(o,a,r,i,c,"throw",e)}i(void 0)})}}function service(props,ctx){var loading=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(!1),render=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(!1),api=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(_config__WEBPACK_IMPORTED_MODULE_1__.a.vuejx),apiReindexAll=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(_config__WEBPACK_IMPORTED_MODULE_1__.a.reindexAll),postData=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)({}),metadataConfig=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)({}),valid=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(!1),from=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(null),until=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(null),type=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(!1),sites=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)([]),siteSelected=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(props.site),renderWorkflow=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)(!1),buckets=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)([]),bucket=Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.value)("");Object(vue_function_api__WEBPACK_IMPORTED_MODULE_0__.onDestroyed)(function(){clean()});var clean=function(){loading.value=!1,render.value=!1,api.value="",postData.value=null,metadataConfig.value=null,valid.value=null},pullConfig=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(""===props.collection){_context.next=3;break}return _context.next=3,ctx.parent.$store.dispatch("vuejx_manager/userOne",{db:"vuejx_cfg",collection:"vuejx_collection",filter:{shortName:props.collection},keys:{metadataConfig:1}}).then(function(data){metadataConfig.value=null!=data?eval("("+data.metadataConfig+")").form:{}}).catch(function(e){metadataConfig.value={}});case 3:case"end":return _context.stop()}},_callee)}));return function(){return _ref.apply(this,arguments)}}(),pullDetail=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pullConfig();case 2:if("_schemas"!==props.collection){e.next=7;break}return e.next=5,ctx.parent.$store.dispatch("vuejx_manager/pullDB",{db:props.database,collection:props.collection,params:{pagesize:1e3}}).then(function(e){postData.value=e._embedded.find(function(e){return e._id===props.id});var t={};for(var n in postData.value)"_id"!==n&&"id"!==n&&"$schema"!==n&&"_etag"!==n&&(t[n]=postData.value[n]);postData.value.shortName=postData.value._id,postData.value.tableConfig=JSON.stringify(t),postData.value.tableConfig=void 0!==postData.value.tableConfig?postData.value.tableConfig:"{}"}).catch(function(e){postData.value={}});case 5:e.next=9;break;case 7:return e.next=9,ctx.parent.$store.dispatch("vuejx_manager/userById",{db:props.database,collection:props.collection,id:props.id}).then(function(e){postData.value=e}).catch(function(e){postData.value={}});case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),toPage=function(e){var t=window.Vue.$router.history.current.params;Vue.redirect(null,!1,"/admin/"+(void 0!==t.database?t.database:"vuejx_cfg")+"/"+e+"/"+(void 0!==t.site?t.site:"guest"),!0)},refresh=function(){location.reload(!0)},addData=function(){ctx.refs.form.validate()&&(postData.value.site=props.site,loading.value=!0,ctx.parent.$store.dispatch("vuejx_manager/userCreate",{db:props.database,collection:props.collection,body:postData.value}).then(function(e){loading.value=!1,backURL()}).catch(function(e){loading.value=!1}),loading.value=!1)},editData=function(e){ctx.refs.form.validate()&&(postData.value.site=props.site,loading.value=!0,ctx.parent.$store.dispatch("vuejx_manager/userUpdateById",{db:props.database,collection:props.collection,body:postData.value}).then(function(t){loading.value=!1,window.Vue.toastr.success("Success."),0===e&&backURL()}).catch(function(e){loading.value=!1}))},removeData=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ctx.parent.$store.dispatch("vuejx_manager/userRemoveById",{db:props.database,collection:props.collection,id:props.id});case 2:backURL();case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),backURL=function(){Vue.$router.go(-1)},toURL=function(e){Vue.redirect(null,!1,e)},reindex=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ctx.parent.$store.dispatch("vuejx_manager/reindex",{api:_config__WEBPACK_IMPORTED_MODULE_1__.a.reindex,db:props.database,collection:props.collection,from:null!==from.value?new Date(from.value).getTime():"",until:null!==until.value?new Date(until.value).getTime():"",type:type.value,all:"false"}).then(function(e){}).catch(function(e){console.log(e)});case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),reindexAll=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ctx.parent.$store.dispatch("vuejx_manager/reindex",{api:_config__WEBPACK_IMPORTED_MODULE_1__.a.reindex,db:props.database,collection:props.collection,from:null!==from.value?new Date(from.value).getTime():"",until:null!==until.value?new Date(until.value).getTime():"",type:type.value,all:"true"}).then(function(e){}).catch(function(e){console.log(e)});case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),mergeOAI=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Vue.redirect(null,!1,"/admin/"+props.database+"/"+props.collection+"/"+props.site+"/"+props.id+"/async/"+postData.value.shortName+"/"+postData.value.storeCollection);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),doChangeSite=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Vue.redirect(null,!1,"/admin/"+props.database+"/"+props.collection+"/"+siteSelected.value);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),asyncOAI=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ctx.parent.$store.dispatch("vuejx_manager/pullAPI",{api:_config__WEBPACK_IMPORTED_MODULE_1__.a.async+props.id,params:{from:null!==from.value?new Date(from.value).getTime():"",until:null!==until.value?new Date(until.value).getTime():""}}).then(function(e){}).catch(function(e){console.log(e)});case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),initSite=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={_source:{includes:["shortName","title"]},query:{bool:{}}},e.next=3,ctx.parent.$store.dispatch("vuejx_manager/graphqlQuery",{query:"\n                query search($token: String, $body: JSON, $db: String, $collection: String) {\n                    results: search(token: $token, body: $body, db: $db, collection: $collection )\n                }\n            ",variables:{body:t,db:"vuejx_cfg",collection:"vuejx_site"}}).then(function(e){void 0!==e.results&&null!==e.results?sites.value=e.results.hits.hits:sites.value=[]}).catch(function(e){sites.value=[]});case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),pullDetailPrototype=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:renderWorkflow.value=!1,postData.value=t,setTimeout(function(){renderWorkflow.value=!0},100);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),pullBuckets=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return render.value=!1,buckets.value=[],e.next=4,ctx.parent.$store.dispatch("vuejx_manager/userMany",{db:"vuejx_cfg",collection:"vuejx_collection",keys:{shortName:1,title:1},limit:1e3}).then(function(e){buckets.value=null!=e?e.hits.hits:[],render.value=!0}).catch(function(e){buckets.value=[],render.value=!0});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),doChangeBuckets=function(){};return{clean:clean,loading:loading,postData:postData,valid:valid,toPage:toPage,addData:addData,refresh:refresh,backURL:backURL,editData:editData,toURL:toURL,api:api,pullDetail:pullDetail,metadataConfig:metadataConfig,render:render,pullConfig:pullConfig,removeData:removeData,reindex:reindex,from:from,until:until,type:type,mergeOAI:mergeOAI,asyncOAI:asyncOAI,initSite:initSite,sites:sites,doChangeSite:doChangeSite,siteSelected:siteSelected,apiReindexAll:apiReindexAll,reindexAll:reindexAll,pullDetailPrototype:pullDetailPrototype,renderWorkflow:renderWorkflow,buckets:buckets,pullBuckets:pullBuckets,bucket:bucket,doChangeBuckets:doChangeBuckets}}__webpack_exports__.a=service}}]);