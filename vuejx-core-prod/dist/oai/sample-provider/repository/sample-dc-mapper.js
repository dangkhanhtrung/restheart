"use strict";var __awaiter=this&&this.__awaiter||function(i,n,s,_){return new(s=s||Promise)(function(e,r){function t(e){try{o(_.next(e))}catch(e){r(e)}}function a(e){try{o(_.throw(e))}catch(e){r(e)}}function o(r){r.done?e(r.value):new s(function(e){e(r.value)}).then(t,a)}o((_=_.apply(i,n||[])).next())})},__generator=this&&this.__generator||function(t,a){var o,i,n,e,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return e={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function r(r){return function(e){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=0<(n=s.trys).length&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=a.call(t,s)}catch(e){r=[6,e],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,e])}}},__asyncValues=this&&this.__asyncValues||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=o[Symbol.asyncIterator];return r?r.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),e={},t("next"),t("throw"),t("return"),e[Symbol.asyncIterator]=function(){return this},e);function t(a){e[a]=o[a]&&function(t){return new Promise(function(e,r){(function(r,e,t,a){Promise.resolve(a).then(function(e){r({value:e,done:t})},e)})(e,r,(t=o[a](t)).done,t.value)})}}};Object.defineProperty(exports,"__esModule",{value:!0});var api_1=require("../../../api"),jsonMapper=require("json-mapper-json"),oai_pmh_1=require("oai-pmh"),SampleDcMapper=function(){function SampleDcMapper(){}return SampleDcMapper.prototype.setTimeZoneOffset=function(e){var r=new Date(e.modifiedAt);return new Date(r.getTime()+-6e4*r.getTimezoneOffset()).toISOString().split(".")[0]+"Z"},SampleDcMapper.prototype.createItemRecord=function(e){var r=this.setTimeZoneOffset(e),t=[];t.push({_attr:{"xmlns:oai_dc":"http://www.openarchives.org/OAI/2.0/oai_dc/","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://www.openarchives.org/OAI/2.0/oai_dc/ http://www.openarchives.org/OAI/2.0/oai_dc.xsd"}});var a="oai_dc:dc";for(var o in e){"type"===o&&(a=e[o]);var i={};if("object"==typeof e[o])if(Array.isArray(e[o])&&void 0!==e[o]&&null!==e[o])for(var n in e[o])if(null!==e[o][n]&&e[o][n].hasOwnProperty("_source")){var s=[];for(var _ in e[o][n]){(w={})[_]=e[o][n][_];var c=[];for(var u in e[o][n][_])if("shortName"===u||"title"===u||"type"===u){var p={};p[u]=e[o][n][_][u],c.push(p)}s.push({_source:c})}(d={})[o]=s,t.push(d)}else{var d={};for(var _ in d[o]=[],e[o][n])if("object"==typeof e[o][n][_]&&null!==e[o][n][_]){var l={};for(var m in l[_]=[],e[o][n][_])if("object"==typeof e[o][n][_][m])for(var f in e[o][n][_][m])if("shortName"===f||"title"===f||"type"===f){var y={};y[f]=e[o][n][_][m][f],l[_].push(y)}d[o].push(l)}else{var h={};h[_]=e[o][n][_],d[o].push(h)}t.push(d)}else if(Array.isArray(e[o])||void 0===e[o]._source||null===e[o]._source){var k={};for(var v in k[o]=[],e[o]){if(Array.isArray(e[o][v])){for(var I in e[o][v])if(null!==e[o][v][I]&&e[o][v][I].hasOwnProperty("_source")){var g,b=[];for(var O in e[o][v][I]._source)if("shortName"===O||"title"===O||"type"===O){var x={};x[O]=e[o][v][I]._source[O],b.push(x)}(g={})[v]=[{_source:b}],k[o].push(g)}}else(g={})[v]=e[o][v],k[o].push(g)}t.push(k)}else{s=[{_source:[]}];for(var _ in e[o]._source){var w;if("shortName"===_||"title"===_||"type"===_)(w={})[_]=e[o]._source[_],s[0]._source.push(w)}i[o]=s,t.push(i)}else i[o]=e[o],t.push(i)}var P=[],j={};j[a]=t,P.push(j);var S={record:[{header:[{identifier:e.id.toString()},{datestamp:r}]},{metadata:P}]},N=JSON.stringify(S).replace(/&/g,"&amp;").replace(/\\b/g,"");return JSON.parse(N)},SampleDcMapper.prototype.mapOaiDcListRecords=function(e){},SampleDcMapper.prototype.mapOaiDcGetRecord=function(e){var r=e.pop();if(!r)throw new Error("Record not found");return this.createItemRecord(r)},SampleDcMapper.prototype.mapOaiDcListIdentifiers=function(e){for(var r=[],t={ListIdentifiers:[]},a=0,o=e;a<o.length;a++){var i=o[a],n=this.setTimeZoneOffset(i),s={record:[{header:[{identifier:i.id.toString()},{datestamp:n}]}]};r.push(s)}return t.ListIdentifiers=r,t},SampleDcMapper.prototype.mapGetRecord=function(i){return __awaiter(this,void 0,void 0,function(){var r,t,a,o;return __generator(this,function(e){switch(e.label){case 0:return r=[],t={GetRecord:[]},void 0===i.identifier||null===i.identifier||""===i.identifier||void 0===i.metadataPrefix||null===i.metadataPrefix||""===i.metadataPrefix?[3,2]:[4,api_1.vuejxService.oaiListRecords("admin",i)];case 1:return a=e.sent(),0===a.total.value?[2,0]:(o=this.createItemRecord(a.hits[0]._source),r.push(o),t.GetRecord=r,[2,t]);case 2:return[2,t]}})})},SampleDcMapper.prototype.mapListRecords=function(u){return __awaiter(this,void 0,void 0,function(){var r,t,a,o,i,n,s,_,c;return __generator(this,function(e){switch(e.label){case 0:return r=[],t={ListRecords:[]},[4,api_1.vuejxService.oaiListRecords("admin",u)];case 1:for(a=e.sent(),o=a.total.value,i=0,n=a.hits;i<n.length;i++)s=n[i],_=this.createItemRecord(s._source),r.push(_);return c="",10===r.length&&(c=a.hits[r.length-1]._source.modifiedAt),10===r.length&&""!==c&&r.push({resumptionToken:[{_attr:{completeListSize:o}},c]}),t.ListRecords=r,[2,t]}})})},SampleDcMapper.prototype.mapIdentify=function(metadataPrefix){return __awaiter(this,void 0,void 0,function(){var response,record,item;return __generator(this,function(_a){switch(_a.label){case 0:return response={Identify:[]},[4,api_1.vuejxService.repoExistOAI("admin",metadataPrefix)];case 1:return record=_a.sent(),item=eval("( "+record.oai_identify_xml+" )"),[4,jsonMapper(record,item).then(function(e){for(var r in e){var t='\n                    {\n                        "'+r+'": "'+e[r]+'"\n                    }\n                ';response.Identify.push(JSON.parse(t))}})];case 2:return _a.sent(),[2,response]}})})},SampleDcMapper.prototype.mapListMetadataFormats=function(metadataPrefix){var e_1,_a,e_2,_b;return __awaiter(this,void 0,void 0,function(){var response,record,_c,_d,element,metadataFormat,arraySchema,formConfig,_e,_f,metadata,_g,keyX1,keyX2,keyTypeX3,listComplexArray,_i,_h,complexElement,_j,keyX1,keyX2,keyTypeX3,e_2_1,e_1_1;return __generator(this,function(_k){switch(_k.label){case 0:return response={ListMetadataFormats:[]},[4,api_1.vuejxService.oaiMetadataFormats("admin",metadataPrefix)];case 1:record=_k.sent(),_k.label=2;case 2:_k.trys.push([2,20,21,26]),_c=__asyncValues(record.hits),_k.label=3;case 3:return[4,_c.next()];case 4:if(_d=_k.sent(),_d.done)return[3,19];if(element=_d.value,metadataFormat=[],void 0===element._source)return[3,17];if(metadataFormat.push({metadataPrefix:element._source.shortName}),arraySchema=[],void 0===element._source.config)return[3,16];formConfig=eval("( "+element._source.config+" )"),_k.label=5;case 5:_k.trys.push([5,10,11,16]),_e=__asyncValues(formConfig.config.form),_k.label=6;case 6:return[4,_e.next()];case 7:if(_f=_k.sent(),_f.done)return[3,9];if(metadata=_f.value,void 0!==metadata.dataType&&"object"!==metadata.dataType&&"complex"!==metadata.dataType)arraySchema.push({element:{_attr:{name:metadata.model,type:metadata.dataType}}});else if(void 0!==metadata.dataType&&"object"===metadata.dataType&&"autocomplete"===metadata.type)_g=metadata.itemText.split("."),keyX1=_g[0],keyX2=_g[1],keyTypeX3=keyX1+".type",arraySchema.push({complexType:[{_attr:{name:metadata.model}},{sequence:[{element:{_attr:{name:metadata.itemValue,type:"string"}}},{element:{_attr:{name:metadata.itemText,type:"string"}}},{element:{_attr:{name:keyTypeX3,type:"string"}}}]}]});else if(void 0!==metadata.dataType&&"complex"===metadata.dataType&&("array"===metadata.type||"object"===metadata.type)){if(listComplexArray=[],void 0!==metadata.config)for(_i=0,_h=metadata.config;_i<_h.length;_i++)complexElement=_h[_i],complexElement.hasOwnProperty("dataType")&&("object"!==complexElement.dataType?listComplexArray.push({element:{_attr:{name:complexElement.model,type:complexElement.dataType}}}):(listComplexArray.push({element:{_attr:{name:complexElement.model+"."+complexElement.itemValue,type:"string"}}}),listComplexArray.push({element:{_attr:{name:complexElement.model+"."+complexElement.itemText,type:"string"}}}),_j=complexElement.itemText.split("."),keyX1=_j[0],keyX2=_j[1],keyTypeX3=keyX1+".type",listComplexArray.push({element:{_attr:{name:complexElement.model+"."+keyTypeX3,type:"string"}}})));arraySchema.push({complexType:[{_attr:{name:metadata.model}},{sequence:listComplexArray}]})}_k.label=8;case 8:return[3,6];case 9:return[3,16];case 10:return e_2_1=_k.sent(),e_2={error:e_2_1},[3,16];case 11:return _k.trys.push([11,,14,15]),_f&&!_f.done&&(_b=_e.return)?[4,_b.call(_e)]:[3,13];case 12:_k.sent(),_k.label=13;case 13:return[3,15];case 14:if(e_2)throw e_2.error;return[7];case 15:return[7];case 16:metadataFormat.push({schema:arraySchema}),_k.label=17;case 17:response.ListMetadataFormats.push({metadataFormat:metadataFormat}),_k.label=18;case 18:return[3,3];case 19:return[3,26];case 20:return e_1_1=_k.sent(),e_1={error:e_1_1},[3,26];case 21:return _k.trys.push([21,,24,25]),_d&&!_d.done&&(_a=_c.return)?[4,_a.call(_c)]:[3,23];case 22:_k.sent(),_k.label=23;case 23:return[3,25];case 24:if(e_1)throw e_1.error;return[7];case 25:return[7];case 26:return[2,response]}})})},SampleDcMapper.prototype.jsonConverter=function(metadataPrefix){var e_3,_a;return __awaiter(this,void 0,void 0,function(){var record,oai_json_mapping_datasource,oaiPmh,identifierIterator,identifierIteratorData,identifierIterator_1,identifierIterator_1_1,identifier,e_3_1,item,resultIdentify;return __generator(this,function(_b){switch(_b.label){case 0:return[4,api_1.vuejxService.repoExistOAI("admin",metadataPrefix)];case 1:record=_b.sent(),oai_json_mapping_datasource=eval("( "+record.oai_json_mapping_datasource+" )"),oaiPmh=new oai_pmh_1.OaiPmh(record.oai_input_url),identifierIterator=oaiPmh.listRecords({metadataPrefix:metadataPrefix}),identifierIteratorData={ListRecords:{record:[]}},_b.label=2;case 2:_b.trys.push([2,7,8,13]),identifierIterator_1=__asyncValues(identifierIterator),_b.label=3;case 3:return[4,identifierIterator_1.next()];case 4:if(identifierIterator_1_1=_b.sent(),identifierIterator_1_1.done)return[3,6];identifier=identifierIterator_1_1.value,identifierIteratorData.ListRecords.record.push(identifier),_b.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return e_3_1=_b.sent(),e_3={error:e_3_1},[3,13];case 8:return _b.trys.push([8,,11,12]),identifierIterator_1_1&&!identifierIterator_1_1.done&&(_a=identifierIterator_1.return)?[4,_a.call(identifierIterator_1)]:[3,10];case 9:_b.sent(),_b.label=10;case 10:return[3,12];case 11:if(e_3)throw e_3.error;return[7];case 12:return[7];case 13:return item=eval("( "+record.oai_json+" )"),resultIdentify=[],[4,jsonMapper(identifierIteratorData,item).then(function(e){resultIdentify=e})];case 14:return _b.sent(),[2,resultIdentify]}})})},SampleDcMapper.prototype.oaiAsync=function(metadataPrefix,token){var e_4,_a;return __awaiter(this,void 0,void 0,function(){var record,item,converter,oai_json_mapping_datasource,apiResource,_b,_c,_i,key,_d,_e,oaiPmh,identifierIterator,identifierIteratorData,listToRemove,inComingRecord,inComingRecordState,identifierIterator_2,identifierIterator_2_1,identifier,desInput,key,_f,_g,keyOb,_h,_j,keyOb,resultOAI,e_4_1;return __generator(this,function(_k){switch(_k.label){case 0:return console.log("oaiAsync",metadataPrefix),[4,api_1.vuejxService.repoExistOAI("admin",metadataPrefix)];case 1:if(record=_k.sent(),item=null,converter=!1,""!==record.oai_json&&void 0!==record.oai_json&&(item=eval("( "+record.oai_json+" )"),converter=!0),oai_json_mapping_datasource={},apiResource={},""===record.oai_json_mapping_datasource||void 0===record.oai_json_mapping_datasource)return[3,5];for(_c in oai_json_mapping_datasource=JSON.parse(record.oai_json_mapping_datasource),_b=[],oai_json_mapping_datasource)_b.push(_c);_i=0,_k.label=2;case 2:return _i<_b.length?(key=_b[_i],"string"!=typeof oai_json_mapping_datasource[key]?[3,4]:(_d=apiResource,_e=key,[4,api_1.vuejxService.pullSourceMapper(token,oai_json_mapping_datasource[key])])):[3,5];case 3:_d[_e]=_k.sent(),_k.label=4;case 4:return _i++,[3,2];case 5:oaiPmh=new oai_pmh_1.OaiPmh(record.oai_input_url),identifierIterator=oaiPmh.listRecords({metadataPrefix:metadataPrefix}),identifierIteratorData={ListRecords:{record:[]}},listToRemove=[],inComingRecord=0,inComingRecordState=0,_k.label=6;case 6:_k.trys.push([6,15,16,21]),identifierIterator_2=__asyncValues(identifierIterator),_k.label=7;case 7:return[4,identifierIterator_2.next()];case 8:return identifierIterator_2_1=_k.sent(),identifierIterator_2_1.done?[3,14]:(identifier=identifierIterator_2_1.value,identifier.hasOwnProperty("header")&&identifier.header.hasOwnProperty("$")&&"deleted"===identifier.header.$.status&&listToRemove.push(identifier.metadata),inComingRecord+=1,desInput={},converter?(identifierIteratorData.ListRecords.record=[identifier],[4,jsonMapper(identifierIteratorData,item).then(function(e){desInput=e.hits[0]})]):[3,10]);case 9:return _k.sent(),[3,11];case 10:"project"===metadataPrefix?metadataPrefix="Project":"publication"===metadataPrefix&&(metadataPrefix="Publication"),desInput=identifier.metadata[metadataPrefix],desInput.hasOwnProperty("$")&&delete desInput.$,_k.label=11;case 11:for(key in inComingRecordState+=1,oai_json_mapping_datasource)if("string"!=typeof oai_json_mapping_datasource[key])if(Array.isArray(desInput[key]))for(_f=0,_g=desInput[key];_f<_g.length;_f++)keyOb=_g[_f],keyOb.hasOwnProperty("_source")&&keyOb._source.hasOwnProperty("shortName")&&""!==keyOb._source.shortName&&void 0!==keyOb._source.shortName&&null!==keyOb._source.shortName&&(keyOb._source.title=oai_json_mapping_datasource[key][keyOb._source.shortName]);else void 0!==desInput[key]&&null!==desInput[key]&&desInput[key].hasOwnProperty("_source")&&desInput[key]._source.hasOwnProperty("shortName")&&""!==desInput[key]._source.shortName&&void 0!==desInput[key]._source.shortName&&null!==desInput[key]._source.shortName&&(desInput[key]._source.title=oai_json_mapping_datasource[key][desInput[key]._source.shortName]);else if(Array.isArray(desInput[key]))for(_h=0,_j=desInput[key];_h<_j.length;_h++)keyOb=_j[_h],keyOb.hasOwnProperty("_source")&&keyOb._source.hasOwnProperty("shortName")&&""!==keyOb._source.shortName&&void 0!==keyOb._source.shortName&&null!==keyOb._source.shortName&&(keyOb._source.title=apiResource[key][keyOb._source.shortName]);else void 0!==desInput[key]&&null!==desInput[key]&&desInput[key].hasOwnProperty("_source")&&desInput[key]._source.hasOwnProperty("shortName")&&""!==desInput[key]._source.shortName&&void 0!==desInput[key]._source.shortName&&null!==desInput[key]._source.shortName&&(desInput[key]._source.title=apiResource[key][desInput[key]._source.shortName]);return desInput.site=record.site,[4,api_1.vuejxService.oaiAsync(token,desInput)];case 12:resultOAI=_k.sent(),console.log("resultOAI",resultOAI),_k.label=13;case 13:return[3,7];case 14:return[3,21];case 15:return e_4_1=_k.sent(),e_4={error:e_4_1},[3,21];case 16:return _k.trys.push([16,,19,20]),identifierIterator_2_1&&!identifierIterator_2_1.done&&(_a=identifierIterator_2.return)?[4,_a.call(identifierIterator_2)]:[3,18];case 17:_k.sent(),_k.label=18;case 18:return[3,20];case 19:if(e_4)throw e_4.error;return[7];case 20:return[7];case 21:return console.log("inComingRecordState",inComingRecordState),[2]}})})},SampleDcMapper.prototype.oaiAsyncraw=function(c,e){var u,p;return __awaiter(this,void 0,void 0,function(){var r,t,a,o,i,n,s,_;return __generator(this,function(e){switch(e.label){case 0:return[4,api_1.vuejxService.repoExistOAI("admin",c.toLocaleLowerCase())];case 1:r=e.sent(),t=new oai_pmh_1.OaiPmh(r.oai_input_url),a=t.listRecords({metadataPrefix:c.toLocaleLowerCase()}),o={ListRecords:{record:[]}},e.label=2;case 2:e.trys.push([2,7,8,13]),i=__asyncValues(a),e.label=3;case 3:return[4,i.next()];case 4:if((n=e.sent()).done)return[3,6];s=n.value,o.ListRecords.record.push(s),e.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return _=e.sent(),u={error:_},[3,13];case 8:return e.trys.push([8,,11,12]),n&&!n.done&&(p=i.return)?[4,p.call(i)]:[3,10];case 9:e.sent(),e.label=10;case 10:return[3,12];case 11:if(u)throw u.error;return[7];case 12:return[7];case 13:return[2,o]}})})},SampleDcMapper.prototype.oaiAsyncdes=function(metadataPrefix,token){var e_6,_a;return __awaiter(this,void 0,void 0,function(){var record,item,converter,oai_json_mapping_datasource,apiResource,_b,_c,_i,key,_d,_e,oaiPmh,identifierIterator,identifierIteratorData,identifierIteratorData2,listToRemove,inComingRecord,inComingRecordState,identifierIterator_4,identifierIterator_4_1,identifier,desInput,key,_f,_g,keyOb,_h,_j,keyOb,e_6_1;return __generator(this,function(_k){switch(_k.label){case 0:return[4,api_1.vuejxService.repoExistOAI("admin",metadataPrefix.toLocaleLowerCase())];case 1:if(record=_k.sent(),item=null,converter=!1,""!==record.oai_json&&void 0!==record.oai_json&&(item=eval("( "+record.oai_json+" )"),converter=!0),oai_json_mapping_datasource={},apiResource={},""===record.oai_json_mapping_datasource||void 0===record.oai_json_mapping_datasource)return[3,5];for(_c in oai_json_mapping_datasource=JSON.parse(record.oai_json_mapping_datasource),_b=[],oai_json_mapping_datasource)_b.push(_c);_i=0,_k.label=2;case 2:return _i<_b.length?(key=_b[_i],"string"!=typeof oai_json_mapping_datasource[key]?[3,4]:(_d=apiResource,_e=key,[4,api_1.vuejxService.pullSourceMapper(token,oai_json_mapping_datasource[key])])):[3,5];case 3:_d[_e]=_k.sent(),_k.label=4;case 4:return _i++,[3,2];case 5:oaiPmh=new oai_pmh_1.OaiPmh(record.oai_input_url),identifierIterator=oaiPmh.listRecords({metadataPrefix:metadataPrefix.toLocaleLowerCase()}),identifierIteratorData={ListRecords:{record:[]}},identifierIteratorData2={ListRecords:{record:[]}},listToRemove=[],inComingRecord=0,inComingRecordState=0,_k.label=6;case 6:_k.trys.push([6,14,15,20]),identifierIterator_4=__asyncValues(identifierIterator),_k.label=7;case 7:return[4,identifierIterator_4.next()];case 8:return identifierIterator_4_1=_k.sent(),identifierIterator_4_1.done?[3,13]:(identifier=identifierIterator_4_1.value,identifier.hasOwnProperty("header")&&identifier.header.hasOwnProperty("$")&&"deleted"===identifier.header.$.status&&listToRemove.push(identifier.metadata),inComingRecord+=1,desInput={},converter?(identifierIteratorData.ListRecords.record=[identifier],[4,jsonMapper(identifierIteratorData,item).then(function(e){desInput=e.hits[0]})]):[3,10]);case 9:return _k.sent(),[3,11];case 10:"project"===metadataPrefix?metadataPrefix="Project":"publication"===metadataPrefix&&(metadataPrefix="Publication"),desInput=identifier.metadata[metadataPrefix],desInput.hasOwnProperty("$")&&delete desInput.$,inComingRecordState+=1,_k.label=11;case 11:for(key in oai_json_mapping_datasource)if("string"!=typeof oai_json_mapping_datasource[key])if(Array.isArray(desInput[key]))for(_f=0,_g=desInput[key];_f<_g.length;_f++)keyOb=_g[_f],keyOb.hasOwnProperty("_source")&&keyOb._source.hasOwnProperty("shortName")&&""!==keyOb._source.shortName&&void 0!==keyOb._source.shortName&&null!==keyOb._source.shortName&&(keyOb._source.title=oai_json_mapping_datasource[key][keyOb._source.shortName]);else void 0!==desInput[key]&&null!==desInput[key]&&desInput[key].hasOwnProperty("_source")&&desInput[key]._source.hasOwnProperty("shortName")&&""!==desInput[key]._source.shortName&&void 0!==desInput[key]._source.shortName&&null!==desInput[key]._source.shortName&&(desInput[key]._source.title=oai_json_mapping_datasource[key][desInput[key]._source.shortName]);else if(Array.isArray(desInput[key]))for(_h=0,_j=desInput[key];_h<_j.length;_h++)keyOb=_j[_h],keyOb.hasOwnProperty("_source")&&keyOb._source.hasOwnProperty("shortName")&&""!==keyOb._source.shortName&&void 0!==keyOb._source.shortName&&null!==keyOb._source.shortName&&(keyOb._source.title=apiResource[key][keyOb._source.shortName]);else console.log("apiResource[key]",apiResource[key]),void 0!==desInput[key]&&null!==desInput[key]&&desInput[key].hasOwnProperty("_source")&&desInput[key]._source.hasOwnProperty("shortName")&&""!==desInput[key]._source.shortName&&void 0!==desInput[key]._source.shortName&&null!==desInput[key]._source.shortName&&(desInput[key]._source.title=apiResource[key][desInput[key]._source.shortName]);identifierIteratorData2.ListRecords.record.push(desInput),_k.label=12;case 12:return[3,7];case 13:return[3,20];case 14:return e_6_1=_k.sent(),e_6={error:e_6_1},[3,20];case 15:return _k.trys.push([15,,18,19]),identifierIterator_4_1&&!identifierIterator_4_1.done&&(_a=identifierIterator_4.return)?[4,_a.call(identifierIterator_4)]:[3,17];case 16:_k.sent(),_k.label=17;case 17:return[3,19];case 18:if(e_6)throw e_6.error;return[7];case 19:return[7];case 20:return[2,identifierIteratorData2]}})})},SampleDcMapper.prototype.replaceShortName=function(r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,r.replace(/-/g,"_MINUS_").replace(/\+/g,"_PLUS_").replace(/&/g,"_AND_").replace(/\&/g,"_AND_").replace(/!/g,"_EXCLAMATION_").replace(/\!/g,"_EXCLAMATION_").replace(/\(/g,"_OPEN1_").replace(/{/g,"_OPEN2_").replace(/\{/g,"_OPEN2_").replace(/\[/g,"_OPEN3_").replace(/\]/g,"_CLOSE3_").replace(/]/g,"_CLOSE3_").replace(/\)/g,"_CLOSE2_").replace(/}/g,"_CLOSE1_").replace(/\}/g,"_CLOSE1_").replace(/"/g,"_NHAY_").replace(/'/g,"_NHAY_").replace(/\"/g,"_NHAY_").replace(/\'/g,"_NHAY_").replace(/~/g,"_NGA_").replace(/\~/g,"_NGA_").replace(/\*/g,"_SAO_").replace(/\?/g,"_HOI_").replace(/:/g,"_HAICHAM_").replace(/\:/g,"_HAICHAM_").replace(/\\/g,"_XOET_").replace(/`/g,"_NNONE_").replace(/ /g,"__").replace(/,/g,"_PHAY_").replace(/\./g,"_CHAM_")]})})},SampleDcMapper.prototype.todoTemp=function(){},SampleDcMapper}();exports.SampleDcMapper=SampleDcMapper;