"use strict";var __awaiter=this&&this.__awaiter||function(a,l,r,i){return new(r=r||Promise)(function(e,n){function t(e){try{o(i.next(e))}catch(e){n(e)}}function s(e){try{o(i.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new r(function(e){e(n.value)}).then(t,s)}o((i=i.apply(a,l||[])).next())})},__generator=this&&this.__generator||function(t,s){var o,a,l,e,r={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(l=2&n[0]?a.return:n[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,n[1])).done)return l;switch(a=0,l&&(n=[2&n[0],l.value]),n[0]){case 0:case 1:l=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,a=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(!(l=0<(l=r.trys).length&&l[l.length-1])&&(6===n[0]||2===n[0])){r=0;continue}if(3===n[0]&&(!l||n[1]>l[0]&&n[1]<l[3])){r.label=n[1];break}if(6===n[0]&&r.label<l[1]){r.label=l[1],l=n;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(n);break}l[2]&&r.ops.pop(),r.trys.pop();continue}n=s.call(t,r)}catch(e){n=[6,e],a=0}finally{o=l=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}},_this=this;Object.defineProperty(exports,"__esModule",{value:!0});var ext_1=require("./ext"),config_1=require("../config");exports.initSite=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_site").findOne({shortName:"guest"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_site").insertMany([{type:"vuejx_site",createdAt:n,modifiedAt:n,shortName:"guest",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Guest",order:0,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],description:"Guest",storeDb:"vuejx_cfg",guestHeaderConfig:JSON.stringify(ext_1.guestHeaderConfigDefault),guestFooterConfig:JSON.stringify(ext_1.guestFooterConfigDefault),cssConfig:"\n                    body .page-footer {\n                        border-bottom: 5px solid #23a0f4;\n                        padding-top: 15px;\n                        padding-bottom: 15px;\n                        background: url(http://119.17.200.66:7880/jspui/static/custom/images/bg_footer-home.jpg) center center no-repeat;\n                        background-size: cover;\n                        color: white;\n                        position: absolute;\n                        bottom: 0;\n                        width: 100%;\n                    }\n                "}],s)];case 2:return 1===e.sent().insertedCount?[3,4]:[4,t.abortTransaction()];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"vuejx_site"},{username:1})];case 5:return null!=e.sent()?[3,8]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"vuejx_site",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Danh sách trang dữ liệu",order:4,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:1,publicAccess:1,description:"Danh sách trang dữ liệu",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'ShortName:'\n                    },\n                    {\n                        model: \"storeDb\",\n                        dataType: \"keyword\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs12 sm6\",\n                        label: \"storeDb:\",\n                        itemText: \"_source.title\",\n                        itemValue: \"_source.shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_db\"\n                            }\n                        ]\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12 sm6\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: 'description',\n                        dataType: 'text',\n                        type: 'textarea',\n                        class: 'xs12',\n                        label: 'Description:'\n                    },\n                    {\n                        model: 'guestHeaderConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'guestHeaderConfig:'\n                    },\n                    {\n                        model: 'guestFooterConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'guestFooterConfig:'\n                    },\n                    {\n                        model: 'groupHeaderConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'groupHeaderConfig:'\n                    },\n                    {\n                        model: 'groupFooterConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'groupFooterConfig:'\n                    },\n                    {\n                        model: 'cssConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12',\n                        label: 'cssConfig:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"Danh sách trang dữ liệu\",\n                columns: [\"storeDb\", \"shortName\", \"title\", \"description\", \"order\"],\n                config_columns: [\n                    {\n                        field: '_source.storeDb',\n                        field_query: 'storeDb',\n                        field_sort: 'storeDb',\n                        headerText: 'storeDb',\n                        textAlign: 'left',\n                        width: 150,\n                        minWidth: 150\n                    },\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'ShortName',\n                        textAlign: 'left',\n                        width: 220,\n                        minWidth: 220\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'Title',\n                        textAlign: 'left',\n                        width: 320,\n                        minWidth: 320\n                    },\n                    {\n                        field: '_source.description',\n                        field_query: 'description',\n                        field_sort: 'description',\n                        headerText: 'Description',\n                        textAlign: 'left',\n                    },\n                    {\n                        field: '_source.order',\n                        field_query: 'order',\n                        field_sort: 'order',\n                        headerText: 'Order',\n                        textAlign: 'right',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" }\n                ]\n            }"},s)];case 6:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,8];case 7:e.sent(),t.endSession(),e.label=8;case 8:return[2]}})})},exports.initPage=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_page").findOne({shortName:"home"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_page").insertMany([{type:"vuejx_page",createdAt:n,modifiedAt:n,shortName:"home",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Home",order:4,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],description:"Home",storeDb:"vuejx_cfg",visibility:"web",hidden:!1,siteParent:"guest"}],s)];case 2:return 1===e.sent().insertedCount?[3,4]:[4,t.abortTransaction()];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"vuejx_page"},{username:1})];case 5:return null!=e.sent()?[3,8]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"vuejx_page",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Page",order:5,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:0,publicAccess:0,description:"Page",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs6 sm3',\n                        label: 'ShortName:'\n                    },\n                    {\n                        model: \"siteParent\",\n                        dataType: \"keyword\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs6 sm3\",\n                        label: \"siteParent:\",\n                        itemText: \"title\",\n                        itemValue: \"shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ]\n                    },\n                    {\n                        model: \"storeDb\",\n                        dataType: \"keyword\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs6 sm2\",\n                        label: \"storeDb:\",\n                        itemText: \"_source.title\",\n                        itemValue: \"_source.shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_db\"\n                            }\n                        ]\n                    },\n                    {\n                        model: 'visibility',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm2',\n                        label: 'Hiển thị:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        data: [\n                            {\n                                _source: {\n                                    shortName: 'web',\n                                    title: 'Web'\n                                }\n                            },\n                            {\n                                _source: {\n                                    shortName: 'group',\n                                    title: 'Group'\n                                }\n                            }\n                        ]\n                    },\n                    {\n                        model: 'hidden',\n                        dataType: 'boolean',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm2',\n                        label: 'Hidden:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        data: [\n                            {\n                                _source: {\n                                    shortName: true,\n                                    title: 'Hidden'\n                                }\n                            },\n                            {\n                                _source: {\n                                    shortName: false,\n                                    title: 'Show'\n                                }\n                            }\n                        ]\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs16 sm3\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: \"pageParent\",\n                        dataType: \"keyword\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs6 sm3\",\n                        label: \"pageParent:\",\n                        itemText: \"title\",\n                        itemValue: \"shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_page\"\n                            }\n                        ]\n                    },\n                    {\n                        model: 'description',\n                        dataType: 'text',\n                        type: 'textarea',\n                        class: 'xs12',\n                        label: 'Description:'\n                    },\n                    {\n                        model: 'pageHeaderConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'pageHeaderConfig:'\n                    },\n                    {\n                        model: 'pageFooterConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'pageFooterConfig:'\n                    },\n                    {\n                        model: 'pageConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'pageConfig:'\n                    },\n                    {\n                        model: 'cssConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm3',\n                        label: 'cssConfig:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"Danh sách Page\",\n                columns: [\"siteParent\", \"shortName\", \"title\", \"description\", \"order\"],\n                config_columns: [\n                    {\n                        field: '_source.siteParent',\n                        field_query: 'siteParent',\n                        field_sort: 'siteParent',\n                        headerText: 'siteParent',\n                        textAlign: 'left',\n                        width: 150,\n                        minWidth: 150\n                    },\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'ShortName',\n                        textAlign: 'left',\n                        width: 220,\n                        minWidth: 220\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'Title',\n                        textAlign: 'left',\n                        width: 320,\n                        minWidth: 320\n                    },\n                    {\n                        field: '_source.description',\n                        field_query: 'description',\n                        field_sort: 'description',\n                        headerText: 'Description',\n                        textAlign: 'left',\n                    },\n                    {\n                        field: '_source.order',\n                        field_query: 'order',\n                        field_sort: 'order',\n                        headerText: 'Order',\n                        textAlign: 'right',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" }\n                ]\n            }"},s)];case 6:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,8];case 7:e.sent(),t.endSession(),e.label=8;case 8:return[2]}})})},exports.initDB=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_db").findOne({shortName:"directory"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_db").insertMany([{type:"vuejx_db",createdAt:n,modifiedAt:n,shortName:"directory",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Cơ sở dữ liệu danh mục",order:1,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],description:"Cơ sở dữ liệu danh mục"}],s)];case 2:return 1===e.sent().insertedCount?[3,4]:[4,t.abortTransaction()];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"vuejx_db"},{username:1})];case 5:return null!=e.sent()?[3,8]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"vuejx_db",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Danh sách cớ sở dữ liệu",order:0,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:0,publicAccess:0,description:"Danh sách cớ sở dữ liệu",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'ShortName:'\n                    },\n                    {\n                        model: 'title',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12',\n                        label: 'Title:'\n                    },\n                    {\n                        model: 'description',\n                        dataType: 'text',\n                        type: 'textarea',\n                        class: 'xs12',\n                        label: 'Description:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"Entities management\",\n                columns: [\"shortName\", \"title\", \"description\", \"order\"],\n                config_columns: [\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'ShortName',\n                        textAlign: 'left',\n                        width: 220,\n                        minWidth: 220\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'Title',\n                        textAlign: 'left',\n                        width: 320,\n                        minWidth: 320\n                    },\n                    {\n                        field: '_source.description',\n                        field_query: 'description',\n                        field_sort: 'description',\n                        headerText: 'Description',\n                        textAlign: 'left',\n                    },\n                    {\n                        field: '_source.order',\n                        field_query: 'order',\n                        field_sort: 'order',\n                        headerText: 'Order',\n                        textAlign: 'right',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" }\n                ]\n            }"},s)];case 6:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,8];case 7:e.sent(),t.endSession(),e.label=8;case 8:return[2]}})})},exports.initCollection=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"vuejx_collection"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"vuejx_collection",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Danh sách metadata",order:1,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:0,publicAccess:0,description:"Danh sách metadata",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'ShortName:'\n                    },\n                    {\n                        model: \"storeDb\",\n                        dataType: \"keyword\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs12 sm3\",\n                        label: \"storeDb:\",\n                        itemText: \"_source.title\",\n                        itemValue: \"_source.shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_db\"\n                            }\n                        ]\n                    },\n                    {\n                        model: \"schema\",\n                        dataType: \"object\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs12 sm3\",\n                        label: \"schema:\",\n                        itemText: \"_source.name\",\n                        itemValue: \"_source.name\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"_schemas\"\n                            }\n                        ]\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12 sm6\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: 'rightMode',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs12 sm6',\n                        label: 'rightMode:',\n                        itemText: 'title',\n                        itemValue: 'shortName',\n                        data: [\n                            {\n                                shortName: 0,\n                                title: \"Theo phân quyền của từng bản ghi\"\n                            },\n                            {\n                                shortName: 1,\n                                title: \"Cho phép đọc tất cả bản ghi\"\n                            },\n                            {\n                                shortName: 2,\n                                title: \"Cho phép đọc/ghi tất cả bản ghi\"\n                            }\n                        ]\n                    },\n                    {\n                        model: 'publicAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs12 sm6',\n                        label: 'publicAccess:',\n                        itemText: 'title',\n                        itemValue: 'shortName',\n                        data: [\n                            {\n                                shortName: 0,\n                                title: \"Không cho phép guest truy cập\"\n                            },\n                            {\n                                shortName: 1,\n                                title: \"Cho phép guest truy cập nhưng ko được tạo mới\"\n                            },\n                            {\n                                shortName: 2,\n                                title: \"Cho phép guest truy cập và tạo mới dữ liệu\"\n                            }\n                        ]\n                    },\n                    {\n                        model: 'description',\n                        dataType: 'text',\n                        type: 'textarea',\n                        class: 'xs12',\n                        label: 'Description:'\n                    },\n                    {\n                        model: 'metadataConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm6',\n                        label: 'metadataConfig:'\n                    },\n                    {\n                        model: 'tableConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm6',\n                        label: 'tableConfig:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"Danh sách metadata\",\n                columns: [\"storeDb\", \"shortName\", \"title\", \"description\", \"order\"],\n                config_columns: [\n                    {\n                        field: '_source.storeDb',\n                        field_query: 'storeDb',\n                        field_sort: 'storeDb',\n                        headerText: 'storeDb',\n                        textAlign: 'left',\n                        width: 150,\n                        minWidth: 150\n                    },\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'ShortName',\n                        textAlign: 'left',\n                        width: 220,\n                        minWidth: 220\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'Title',\n                        textAlign: 'left',\n                        width: 320,\n                        minWidth: 320\n                    },\n                    {\n                        field: '_source.description',\n                        field_query: 'description',\n                        field_sort: 'description',\n                        headerText: 'Description',\n                        textAlign: 'left',\n                    },\n                    {\n                        field: '_source.order',\n                        field_query: 'order',\n                        field_sort: 'order',\n                        headerText: 'Order',\n                        textAlign: 'right',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" }\n                ]\n            }"},s)];case 2:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,4];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[2]}})})},exports.initOaiPmhConfig=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("oai_pmh_config").findOne({shortName:"demo"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("oai_pmh_config").insertMany([{type:"oai_pmh_config",createdAt:n,modifiedAt:n,shortName:"demo",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Demo Config",order:9997,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],description:"Demo Config",storeDb:"demo",storeCollection:"project",prefix:"project",oai_identify_xml:'{\n                    "repositoryName": {\n                      path: "$empty",\n                      formatting: (value, index) => ( "fds:project" )\n                    },\n                    "baseURL": {\n                      path: "$empty",\n                      formatting: (value, index) => ( "/vuejx/oai?verb=Identify&metadataPrefix=project" )\n                    },\n                    "protocolVersion": {\n                      path: "$empty",\n                      formatting: (value, index) => ( "2.0" )\n                    },\n                    "adminEmail": {\n                      path: "$empty",\n                      formatting: (value, index) => ( "binhth.vuejx@gmail.com" )\n                    },\n                    "deletedRecord": {\n                      path: "$empty",\n                      formatting: (value, index) => ( "no" )\n                    },\n                    "earliestDatestamp": {\n                      path: "$empty",\n                      formatting: (value, index) => ( 0 )\n                    },\n                    "granularity": "$root.modifiedAt"\n                }',oai_json_mapping_datasource:'{\n                    "project_Subject": "subject_collection:dict_item",\n                    "project_Authority": "authority_collection:dict_item",\n                    "project_Type": {\n                        "Đề tài": "1",\n                        "Đề án": "2",\n                        "Dự án": "3",\n                        "Hợp tác quốc tế": "4"\n                    },\n                    "project_Status": {\n                        "Đang tiến hành": "1",\n                        "Đã kết thúc": "2"\n                    },\n                    "project_Level": {\n                        "Quốc gia": "1",\n                        "Bộ": "2",\n                        "Tỉnh thành": "3",\n                        "Cơ sở": "4",\n                        "Ngoài ngân sách": "5"\n                    },\n                    "project_OpenAccess": {\n                        "Chỉ mục (Metadata only access)": "1",\n                        "Nội bộ (Embargoed Access)": "2",\n                        "Mở (Open Access)": "3",\n                        "Hạn chế (Restricted Access)": "4",\n                        "Không được phép": "5"\n                    }\n                }',oai_json:"{  \n                   'hits':{  \n                      path:'ListRecords.record',\n                      nested:{  \n                            'id':{  \n                                path:'metadata.Project.$.id',\n                                defaultValue:''\n                            },\n                            'shortName':{  \n                                path:'metadata.Project.$.id',\n                                defaultValue:'',\n                                formatting:(value) => {\n                                    if (value !== '') {\n                                        return 'project_' + value;\n                                    } else {\n                                        return 'project_' + new Date().getTime();\n                                    }\n                                }\n                            },\n                         'title':{  \n                                path:'metadata.Project.$.id',\n                                defaultValue:'',\n                                formatting:(value) => {\n                                    if (value !== '') {\n                                        return 'project_' + value;\n                                    } else {\n                                        return 'project_' + new Date().getTime();\n                                    }\n                                }\n                         },\n                         'type':{  \n                            path:\"$empty\",\n                            formatting:(value, index) => ( \"project\" )\n                         },\n                         'project_ID':{  \n                                path:'metadata.Project.$.id',\n                                defaultValue:'',\n                                formatting:(value) => {\n                                    if (value !== '') {\n                                        return 'project_' + value;\n                                    } else {\n                                        return 'project_' + new Date().getTime();\n                                    }\n                                }\n                         },\n                         'project_Acronym':{  \n                            path:'metadata.Project.Acronym',\n                            defaultValue:''\n                         },\n                         'project_Title':{  \n                            path:'metadata.Project.Title',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'_',\n                                        defaultValue: ''\n                                    },\n                                     title: {\n                                        path:'_',\n                                        defaultValue: ''\n                                    }\n                                  }\n                               }\n                            },\n                         },\n                         'project_URL':{  \n                            path:'metadata.Project.URL',  \n                            defaultValue:[],\n                            formatting:(value) => {\n                                if (value !== '') {\n                                    return [{\n                                        _source: {\n                                            shortName: value,\n                                            title: value\n                                        }\n                                    }];\n                                } else {\n                                    return [];\n                                }\n                            }\n                         },\n                         'project_StartDate':{  \n                            path:'metadata.Project.StartDate',\n                            defaultValue:''\n                         },\n                         'project_StartDateYear':{  \n                            path:'metadata.Project.StartDate',\n                            defaultValue: 0,\n                            formatting:(value) => {\n                                if (String(value).indexOf('/') > 0) {\n                                    return parseInt(value.split('/')[1]);\n                                } else {\n                                    return 0;\n                                }\n                                \n                            }\n                         },\n                         'project_EndDate':{  \n                            path:'metadata.Project.EndDate',\n                            defaultValue:''\n                         },\n                         'project_Keyword':{  \n                            path:'metadata.Project',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'_',\n                                        defaultValue: '',\n                                        formatting:(value) => {\n                                            return value.replace(/ /g, '__');\n                                        }   \n                                     },\n                                     title: {\n                                        path:'_',\n                                        defaultValue: ''\n                                    }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Abstract':{  \n                            path:'metadata.Project.Abstract',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'_',\n                                        defaultValue: ''\n                                    },\n                                     title: {\n                                        path:'_',\n                                        defaultValue: ''\n                                    }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Subject':{  \n                            path:'metadata.Project',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'Subject',\n                                        defaultValue: ''\n                                     },\n                                     title: {\n                                        path:'Subject',\n                                        defaultValue: ''\n                                     }\n                                  }\n                               }\n                            },\n                \n                         },\n                         'project_Type':{  \n                            path:'metadata.Project',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'Type',\n                                        defaultValue: ''\n                                     },\n                                     title: {\n                                        path:'Type',\n                                        defaultValue: ''\n                                     }\n                                  }\n                               }\n                            },\n                \n                         },\n                         'project_Status':{  \n                            path:'metadata.Project',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'Status',\n                                        defaultValue: ''\n                                     },\n                                     title: {\n                                        path:'Status',\n                                        defaultValue: ''\n                                     }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Level':{  \n                            path:'metadata.Project',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'Level',\n                                        defaultValue: ''\n                                     },\n                                     title: {\n                                        path:'Level',\n                                        defaultValue: ''\n                                     }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Authority':{  \n                            path:'metadata.Project',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'Authority',\n                                        defaultValue: ''\n                                     },\n                                     title: {\n                                        path:'Authority',\n                                        defaultValue: ''\n                                     }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Consortium':{  \n                            path:'metadata.Project.Consortium',\n                            defaultValue:[],\n                            nested:{  \n                               Contractor:{  \n                                  path:'Contractor',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               },\n                               Coordinator:{  \n                                  path:'Coordinator',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               },\n                               Partner:{  \n                                  path:'Partner',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               },\n                               InKindContributor:{  \n                                  path:'InKindContributor',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'OrgUnit.Name',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Team':{  \n                            path:'metadata.Project.Team',\n                            defaultValue:[],\n                            nested:{  \n                               PrincipalInvestigator:{  \n                                  path:'PrincipalInvestigator',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               },\n                               Member:{  \n                                  path:'Member',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               },\n                               Contact:{  \n                                  path:'Contact',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Funded':{  \n                            path:'metadata.Project.Funded',\n                            defaultValue:[],\n                            nested:{  \n                               By:{  \n                                  path:'By',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               },\n                               As:{  \n                                  path:'As',\n                                  defaultValue:[],\n                                  nested:{  \n                                     _source:{  \n                                        path:'$empty',\n                                        defaultValue:[],\n                                        nested:{  \n                                           shortName: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          },\n                                           title: {\n                                              path:'DisplayName',\n                                              defaultValue: ''\n                                          }\n                                        }\n                                     }\n                                  }\n                               }\n                            }\n                         },\n                         'project_PartOf':{  \n                            path:'metadata.Project.PartOf',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'DisplayName',\n                                        defaultValue: ''\n                                      },\n                                     title: {\n                                        path:'DisplayName',\n                                        defaultValue: ''\n                                      }\n                                  }\n                               }\n                            }\n                         },\n                         'project_Identifier':{  \n                            path:'metadata.Project.Identifier',\n                            defaultValue:''\n                         },\n                         'project_OpenAccess':{  \n                            path:'metadata.Project.OpenAccess',\n                            defaultValue:[],\n                            nested:{  \n                               _source:{  \n                                  path:'$empty',\n                                  defaultValue:[],\n                                  nested:{  \n                                     shortName: {\n                                        path:'DisplayName',\n                                        defaultValue: ''\n                                      },\n                                     title: {\n                                        path:'DisplayName',\n                                        defaultValue: ''\n                                      }\n                                  }\n                               }\n                            }\n                         }\n                      }\n                   }\n                }"}],s)];case 2:return 1===e.sent().insertedCount?[3,4]:[4,t.abortTransaction()];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"oai_pmh_config"},{username:1})];case 5:return null!=e.sent()?[3,8]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"oai_pmh_config",email:"binhth.vuejx@gmail.com",username:"binhth",title:"OAI-PMH Config",order:9997,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:0,publicAccess:0,description:"OAI-PMH Config",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12 sm3',\n                        label: 'Short Name:'\n                    },\n                    {\n                        model: 'prefix',\n                        dataType: 'text',\n                        type: 'text',\n                        class: 'xs12 sm3',\n                        label: 'prefix:'\n                    },\n                    {\n                        model: \"storeDb\",\n                        dataType: \"object\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs12 sm3\",\n                        label: \"storeDb:\",\n                        itemText: \"_source.title\",\n                        itemValue: \"_source.shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_db\"\n                            }\n                        ]\n                    },\n                    {\n                        model: \"storeCollection\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12 sm3\",\n                        label: \"storeCollection:\"\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12 sm6\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: 'description',\n                        dataType: 'text',\n                        type: 'textarea',\n                        class: 'xs12',\n                        label: 'Description:'\n                    },\n                  \t{\n                        model: 'oai_identify_xml',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm6',\n                        label: 'OAI-Identify-XML Config:'\n                    },\n                    {\n                        model: 'oai_json_mapping_datasource',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm6',\n                        label: 'OAI-JSON Config mapping datasource:'\n                    },\n                  \t{\n                        model: 'oai_input_url',\n                        dataType: 'text',\n                        type: 'text',\n                        class: 'xs12',\n                        label: 'oai_input_url:'\n                    },\n                    {\n                        model: 'oai_json',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12',\n                        label: 'OAI-JSON Config:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"OAI-PMH Config\",\n                columns: [\"shortName\", \"title\", \"description\", \"order\", \"status\"],\n                config_columns: [\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'Short Name',\n                        textAlign: 'left',\n                        width: 220,\n                        minWidth: 220\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'Title',\n                        textAlign: 'left',\n                        width: 320,\n                        minWidth: 320\n                    },\n                    {\n                        field: '_source.description',\n                        field_query: 'description',\n                        field_sort: 'description',\n                        headerText: 'Description',\n                        textAlign: 'left',\n                    },\n                    {\n                        field: '_source.order',\n                        field_query: 'order',\n                        field_sort: 'order',\n                        headerText: 'Order',\n                        textAlign: 'right',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.status._source.title',\n                        field_query: 'status._source.title',\n                        field_sort: 'status._source.title',\n                        headerText: 'Status',\n                        textAlign: 'center',\n                        width: 120,\n                        minWidth: 120\n                    },\n                ],\n                sort: [\n                    { \"order\": \"asc\" },\n                    \"_score\"\n                ]\n            }"},s)];case 6:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,8];case 7:e.sent(),t.endSession(),e.label=8;case 8:return[2]}})})},exports.initOaiPmhAsync=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"oai_pmh_async"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"oai_pmh_async",email:"binhth.vuejx@gmail.com",username:"binhth",title:"OAI-PMH ASYNC",order:9998,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:0,publicAccess:0,description:"OAI-PMH ASYNC",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'Short Name:'\n                    },\n                    {\n                        model: \"storeDb\",\n                        dataType: \"object\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs12 sm3\",\n                        label: \"storeDb:\",\n                        itemText: \"_source.title\",\n                        itemValue: \"_source.shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_db\"\n                            }\n                        ]\n                    },\n                    {\n                        model: \"storeCollection\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12 sm3\",\n                        label: \"storeCollection:\"\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12 sm6\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: 'inComingRecord',\n                        dataType: 'integer',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'Số bản ghi nhận:'\n                    },\n                    {\n                        model: 'inComingRecordRemove',\n                        dataType: 'integer',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'Số bản ghi xoá:'\n                    },\n                    {\n                        model: 'inComingRecordState',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs12 sm6',\n                        label: 'Cập nhật thành công:'\n                    },\n                    {\n                        model: 'inComingRecordRemoveState',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs12 sm6',\n                        label: 'Xoá thành công:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"OAI-PMH ASYNC\",\n                columns: [\"storeCode\", \"shortName\", \"inComingRecord\", \"inComingRecordState\", \"inComingRecordRemove\", \"inComingRecordRemoveState\" ],\n                config_columns: [\n                  \t{\n                        field: '_source.storeCode',\n                        field_query: 'storeCode',\n                        field_sort: 'storeCode',\n                        headerText: 'Mã đồng bộ',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        displayAsDate: true,\n                        displayAsDateTime: true,\n                        headerText: 'Ngày đồng bộ',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.inComingRecord',\n                        field_query: 'oaiPmhEntity._source.title',\n                        field_sort: 'oaiPmhEntity._source.title',\n                        headerText: 'Số bản ghi nhận',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.inComingRecordState',\n                        field_query: 'inComingRecordState',\n                        field_sort: 'inComingRecordState',\n                        headerText: 'Cập nhật thành công',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.inComingRecordRemove',\n                        field_query: 'inComingRecordRemove',\n                        field_sort: 'inComingRecordRemove',\n                        headerText: 'Số bản ghi xoá',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.inComingRecordRemoveState',\n                        field_query: 'inComingRecordRemoveState',\n                        field_sort: 'inComingRecordRemoveState',\n                        headerText: 'Xoá thành công',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" },\n                    \"_score\"\n                ]\n            }"},s)];case 2:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,4];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[2]}})})},exports.initScope=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("scope").findOne({shortName:"guest"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("scope").insertMany([{type:"scope",createdAt:n,modifiedAt:n,shortName:"guest",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Scope guest",order:0,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],description:"Scope guest"}],s)];case 2:return 1===e.sent().insertedCount?[3,4]:[4,t.abortTransaction()];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"scope"},{username:1})];case 5:return null!=e.sent()?[3,8]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"scope",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Danh sách scope",order:2,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:1,publicAccess:1,description:"Danh sách scope",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'Short Name:'\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"Danh sách scope\",\n                columns: [\"shortName\", \"title\"],\n                config_columns: [\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'shortName',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'title',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" },\n                    \"_score\"\n                ]\n            }"},s)];case 6:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,8];case 7:e.sent(),t.endSession(),e.label=8;case 8:return[2]}})})},exports.initProjection=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"projection"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"projection",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Danh sách projection",order:3,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:0,publicAccess:0,description:"Danh sách projection",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs6 sm3',\n                        label: 'Short Name:'\n                    },\n                    {\n                        model: 'scope',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'Scope:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"scope\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: 'tableConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12',\n                        label: 'tableConfig:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"Danh sách projection\",\n                columns: [\"shortName\", \"title\"],\n                config_columns: [\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'shortName',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'title',\n                        textAlign: 'left',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" },\n                    \"_score\"\n                ]\n            }"},s)];case 2:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,4];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[2]}})})},exports.initWorkflow=function(e,t,s){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(e){switch(e.label){case 0:return n=(new Date).getTime(),[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").findOne({shortName:"vuejx_workflow"},{username:1})];case 1:return null!=e.sent()?[3,4]:[4,config_1.getClient().db("vuejx_cfg").collection("vuejx_collection").insertOne({type:"vuejx_collection",createdAt:n,modifiedAt:n,shortName:"vuejx_workflow",email:"binhth.vuejx@gmail.com",username:"binhth",title:"Danh sách workflow",order:3,status:{_source:{shortName:"activate",title:"Activate"}},site:"guest",storage:"regular",openAccess:2,accessRoles:[],accessUsers:[],accessEmails:[],rightMode:0,publicAccess:0,description:"Danh sách workflow",storeDb:"vuejx_cfg",metadataConfig:"{\n                type: 0,\n                form: [\n                    {\n                        model: 'createdAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Created date:'\n                    },\n                    {\n                        model: 'modifiedAt',\n                        dataType: 'long',\n                        type: 'view',\n                        format: 'MM/dd/yyyy',\n                        class: 'xs6 sm3',\n                        label: 'Modified date:'\n                    },\n                    {\n                        model: 'shortName',\n                        dataType: 'keyword',\n                        type: 'text',\n                        class: 'xs12 sm6',\n                        label: 'ShortName:'\n                    },\n                    {\n                        model: \"storeDb\",\n                        dataType: \"keyword\",\n                        type: \"autocomplete\",\n                        object: false,\n                        class: \"xs12 sm6\",\n                        label: \"storeDb:\",\n                        itemText: \"_source.title\",\n                        itemValue: \"_source.shortName\",\n                        \"link_mongo\": [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_db\"\n                            }\n                        ]\n                    },\n                    {\n                        model: \"title\",\n                        dataType: \"keyword\",\n                        type: \"text\",\n                        class: \"xs12 sm6\",\n                        label: \"Title:\"\n                    },\n                    {\n                        model: 'description',\n                        dataType: 'text',\n                        type: 'textarea',\n                        class: 'xs12',\n                        label: 'Description:'\n                    },\n                    {\n                        model: 'tableConfig',\n                        dataType: 'text',\n                        type: 'codemirror',\n                        class: 'xs12 sm6',\n                        label: 'tableConfig:'\n                    },\n                    {\n                        model: 'order',\n                        dataType: 'integer',\n                        type: 'number',\n                        class: 'xs6 sm3',\n                        label: 'Order:'\n                    },\n                    {\n                        model: 'status',\n                        dataType: 'object',\n                        type: 'autocomplete',\n                        object: true,\n                        class: 'xs6 sm3',\n                        label: 'Status:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"vuejx_site\",\n                                dictCollection: \"statusRecord\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'openAccess',\n                        dataType: 'integer',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'openAccess:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"open_access\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'storage',\n                        dataType: 'keyword',\n                        type: 'autocomplete',\n                        object: false,\n                        class: 'xs6 sm3',\n                        label: 'storage:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"storage\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessRoles',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessRoles:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"directory\",\n                                collection: \"role\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessUsers',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12 sm6',\n                        label: '_accessUsers:',\n                        itemText: '_source.title',\n                        itemValue: '_source.shortName',\n                        link: [\n                            {\n                                db: \"vuejx_cfg\",\n                                collection: \"vuejx_site\"\n                            }\n                        ],\n                        column: [\"shortName\", \"title\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    },\n                    {\n                        model: 'accessEmails',\n                        dataType: 'object',\n                        type: 'role',\n                        class: 'xs12',\n                        label: '_accessEmails:',\n                        itemText: '_source.userEmail',\n                        itemValue: '_source.userEmail',\n                        link: [\n                            {\n                                db: \"profilesdatabase\",\n                                collection: \"person\"\n                            }\n                        ],\n                        column: [\"userEmail\", \"type\"],\n                        sort: [\n                            { \"order\": \"asc\" },\n                            \"_score\"\n                        ]\n                    }\n                ]\n            }",tableConfig:"{\n                title: \"Danh sách workflow\",\n                columns: [\"storeDb\", \"shortName\", \"title\", \"description\", \"order\"],\n                config_columns: [\n                    {\n                        field: '_source.storeDb',\n                        field_query: 'storeDb',\n                        field_sort: 'storeDb',\n                        headerText: 'storeDb',\n                        textAlign: 'left',\n                        width: 150,\n                        minWidth: 150\n                    },\n                    {\n                        field: '_source.shortName',\n                        field_query: 'shortName',\n                        field_sort: 'shortName',\n                        headerText: 'ShortName',\n                        textAlign: 'left',\n                        width: 220,\n                        minWidth: 220\n                    },\n                    {\n                        field: '_source.title',\n                        field_query: 'title',\n                        field_sort: 'title',\n                        headerText: 'Title',\n                        textAlign: 'left',\n                        width: 320,\n                        minWidth: 320\n                    },\n                    {\n                        field: '_source.description',\n                        field_query: 'description',\n                        field_sort: 'description',\n                        headerText: 'Description',\n                        textAlign: 'left',\n                    },\n                    {\n                        field: '_source.order',\n                        field_query: 'order',\n                        field_sort: 'order',\n                        headerText: 'Order',\n                        textAlign: 'right',\n                        width: 120,\n                        minWidth: 120\n                    }\n                ],\n                sort: [\n                    { \"order\": \"asc\" }\n                ]\n            }"},s)];case 2:return e.sent().insertedCount<=0?[4,t.abortTransaction()]:[3,4];case 3:e.sent(),t.endSession(),e.label=4;case 4:return[2]}})})};